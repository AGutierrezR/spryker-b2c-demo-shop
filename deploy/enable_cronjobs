#!/bin/bash
#
# *** Project-A deployment
#
# enable_cronjobs
# This script is executed on tools host (with root privileges) in order to activate cronjobs
#
#

FILEPATH=`pwd`/$0; BASEDIR=`dirname $FILEPATH`; source $BASEDIR/vars; source $BASEDIR/functions
outfile=`mktemp /tmp/deploy-XXXXXX`

if is_admin_host; then
  # Prepare crontab
  crontab="/etc/cron.d/${environment}-zed"
  src=${destination_release_dir}/config/Zed/cronjobs/crontab

  echo "# This file is autogenerated by deployment" > $crontab
  echo "# To deactivate cronjobs, you can delete this file" >> $crontab
  echo "# It will be automatically created upon next deployment" >> $crontab
  echo "CURRENT_DIR=${destination_current_dir}" >> $crontab
  echo "APPLICATION_ENV=${environment}" >> $crontab
  echo "" >> $crontab
  [ -f $src ] && cat $src >> $crontab
fi

rm -f $outfile
exit 0
