<?xml version="1.0"?>
<database name="zed"
          package="vendor/project-a/sales-package/ProjectA/Zed/Sales/Persistence"
          tablePrefix="pac_"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

    <table name="sales_order_item_status"  phpName="PacSalesOrderItemStatus">
        <column name="id_sales_order_item_status" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />

        <column name="name" type="VARCHAR" size="255" required="true" />
        <column name="description" type="VARCHAR" size="255" required="false" default="NULL"/>
    </table>

    <table name="sales_order_item_status_history"  phpName="PacSalesOrderItemStatusHistory">
        <column name="id_sales_order_item_status_history" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order_item" type="INTEGER" required="true" />
        <column name="fk_sales_order_item_status" type="INTEGER" required="true" />

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order_item" phpName="OrderItem" refPhpName="StatusHistory">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_item_status" phpName="Status" refPhpName="StatusHistory">
            <reference local="fk_sales_order_item_status" foreign="id_sales_order_item_status"/>
        </foreign-key>
    </table>

    <table name="sales_order_item_transition_log"  phpName="PacSalesOrderItemTransitionLog">
        <column name="id_sales_order_item_transition_log" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order_item" type="INTEGER" required="true" />
        <column name="fk_sales_order" type="INTEGER" required="true" />
        <column name="fk_acl_user" type="INTEGER" required="false"/>

        <column name="locked" type="BOOLEAN" required="false" />
        <column name="fk_sales_order_process" type="INTEGER" required="false"/>
        <column name="event" required="false" size="100" type="VARCHAR"/>
        <column name="hostname" type="VARCHAR" size="128" required="true" />
        <column name="module" type="VARCHAR" size="128" required="true" />
        <column name="controller" type="VARCHAR" size="128" required="true" />
        <column name="action" type="VARCHAR" size="128" required="true" />
        <column name="params" type="ARRAY" required="true" />
        <column name="source_state" type="VARCHAR" size="128" required="false" />
        <column name="target_state" type="VARCHAR" size="128" required="false" />
        <column name="commands" type="ARRAY" required="false" />
        <column name="conditions" type="ARRAY" required="false" />
        <column name="error" type="BOOLEAN" required="false" />
        <column name="error_message" type="VARCHAR" size="1024" required="false" />

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="TransitionLog">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_item" phpName="OrderItem" refPhpName="TransitionLog">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>
        <foreign-key foreignTable="acl_user" phpName="AclUser" refPhpName="TransitionLog">
            <reference local="fk_acl_user" foreign="id_acl_user"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_process" phpName="Process" refPhpName="TransitionLog">
            <reference local="fk_sales_order_process" foreign="id_sales_order_process"/>
        </foreign-key>
    </table>

    <table name="sales_order_address"  phpName="PacSalesOrderAddress">
        <column name="id_sales_order_address" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_misc_country" type="INTEGER" required="true"/>

        <column name="salutation" type="ENUM" valueSet="Mr, Mrs, Dr"/>
        <column name="first_name" required="true" size="100" type="VARCHAR"/>
        <column name="middle_name" required="false" size="100" type="VARCHAR"/>
        <column name="last_name" required="true" size="100" type="VARCHAR"/>
        <column name="address1" required="true" size="255" type="VARCHAR"/>
        <column name="address2" size="255" type="VARCHAR"/>
        <column name="address3" size="255" type="VARCHAR"/>
        <column name="company" size="255" type="VARCHAR"/>
        <column name="city" size="255" type="VARCHAR" required="true"/>
        <column name="zip_code" size="15" type="VARCHAR" required="true"/>
        <column name="po_box" size="255" type="VARCHAR"/>
        <column name="phone" size="255" type="VARCHAR"/>
        <column name="cell_phone" size="255" type="VARCHAR"/>
        <column name="description" size="255" type="VARCHAR"/>
        <column name="comment" size="255" type="VARCHAR"/>
        <column name="email" size="255" type="VARCHAR" required="false"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="misc_country" phpName="Country" refPhpName="SalesOrderAddress">
            <reference local="fk_misc_country" foreign="id_misc_country"/>
        </foreign-key>
    </table>

    <table name="sales_order_address_history"  phpName="PacSalesOrderAddressHistory">
        <column name="id_sales_order_address_history" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_misc_country" type="INTEGER" required="true"/>
        <column name="fk_sales_order_address" type="INTEGER" required="true"/>

        <column name="is_billing" type="BOOLEAN" default="0" />
        <column name="salutation" type="ENUM" valueSet="Mr, Mrs, Dr"/>
        <column name="first_name" required="true" size="100" type="VARCHAR"/>
        <column name="middle_name" required="false" size="100" type="VARCHAR"/>
        <column name="last_name" required="true" size="100" type="VARCHAR"/>
        <column name="address1" required="true" size="255" type="VARCHAR"/>
        <column name="address2" size="255" type="VARCHAR"/>
        <column name="address3" size="255" type="VARCHAR"/>
        <column name="company" size="255" type="VARCHAR"/>
        <column name="city" size="255" type="VARCHAR" required="true"/>
        <column name="zip_code" size="15" type="VARCHAR" required="true"/>
        <column name="po_box" size="255" type="VARCHAR"/>
        <column name="phone" size="255" type="VARCHAR"/>
        <column name="cell_phone" size="255" type="VARCHAR"/>
        <column name="description" size="255" type="VARCHAR"/>
        <column name="comment" size="255" type="VARCHAR"/>
        <column name="email" size="255" type="VARCHAR" required="false"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="misc_country" phpName="Country" refPhpName="SalesOrderAddressHistory">
            <reference local="fk_misc_country" foreign="id_misc_country"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_address" phpName="SalesOrderAddress" refPhpName="SalesOrderAddressHistory">
            <reference local="fk_sales_order_address" foreign="id_sales_order_address"/>
        </foreign-key>
    </table>

    <table name="sales_order"  phpName="PacSalesOrder">
        <column name="id_sales_order" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order_address_billing" type="INTEGER" required="true"/>
        <column name="fk_sales_order_address_shipping" type="INTEGER" required="true"/>
        <column name="fk_customer" type="INTEGER" required="false"/>
        <column name="fk_sales_order_process" type="INTEGER" required="false"/>

        <column name="email" required="false" size="255" type="VARCHAR"/>
        <column name="salutation" type="ENUM" valueSet="Mr, Mrs, Dr" required="false"/>
        <column name="first_name" required="false" size="100" type="VARCHAR"/>
        <column name="last_name" required="false" size="100" type="VARCHAR"/>
        <column name="customer_session_id" required="false" size="100" type="VARCHAR"/>
        <column name="increment_id" type="VARCHAR" size="45" required="false"/>
        <column name="invoice_number" type="VARCHAR" size="45" required="false"/>
        <column name="invoice_generated_at" type="TIMESTAMP" required="false"/>
        <column name="ip_address" type="VARCHAR" size="15" required="false" default="NULL"/>
        <column name="grand_total" type="INTEGER" required="true"/>
        <column name="subtotal" type="INTEGER" required="true"/>
        <column name="is_test" type="BOOLEAN" required="true" default="false"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order_address" phpName="BillingAddress">
            <reference local="fk_sales_order_address_billing" foreign="id_sales_order_address"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_address" phpName="ShippingAddress">
            <reference local="fk_sales_order_address_shipping" foreign="id_sales_order_address"/>
        </foreign-key>
        <foreign-key foreignTable="customer" phpName="Customer" refPhpName="Order">
            <reference local="fk_customer" foreign="id_customer"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_process" phpName="Process" refPhpName="Order">
            <reference local="fk_sales_order_process" foreign="id_sales_order_process"/>
        </foreign-key>
        <unique>
            <unique-column name="increment_id"/>
        </unique>
        <unique>
            <unique-column name="invoice_number"/>
        </unique>
    </table>

    <table name="sales_order_item"  phpName="PacSalesOrderItem">
        <column name="id_sales_order_item" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order" type="INTEGER" required="true"/>
        <column name="fk_sales_order_item_status" type="INTEGER" required="true"/>
        <column name="fk_sales_order_process" type="INTEGER" required="false"/>

        <column name="last_status_change" type="TIMESTAMP" required="true" defaultExpr="CURRENT_TIMESTAMP" />
        <column name="name" type="VARCHAR" size="255" required="true"/>
        <column name="sku" type="VARCHAR" size="255" required="true"/>
        <column name="gross_price" type="INTEGER" required="true" description="/price for one unit including tax, without shipping, coupons/"/>
        <column name="price_to_pay" type="INTEGER" required="true" description="/value that the customer has to pay. TODO define calculation rules .unit_price + tax_amount + shipping_amount - coupon_amount./"/>
        <column name="paid_amount" type="INTEGER" required="false" default="0" description="/amount which the customer really paid/"/>
        <column name="tax_amount" type="INTEGER" required="false" description="/tax money value/"/>
        <column name="tax_percentage" type="DECIMAL" size="8" scale="4" required="false" description="/tax percentage/"/>

        <!-- flags -->
        <column name="to_be_captured" type="BOOLEAN" required="false" default="NULL" />
        <column name="to_be_billed" type="BOOLEAN" required="false" default="NULL" />
        <!-- end of flags -->

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Item">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_item_status" phpName="Status" refPhpName="Order">
            <reference local="fk_sales_order_item_status" foreign="id_sales_order_item_status"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order_process" phpName="Process" refPhpName="Item">
            <reference local="fk_sales_order_process" foreign="id_sales_order_process"/>
        </foreign-key>
        <index>
        	<index-column name="sku" />
        </index>
    </table>

    <table name="sales_order_item_option"  phpName="PacSalesOrderItemOption">
        <column name="id_sales_order_item_option" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order_item" type="INTEGER" required="true" />

        <column name="identifier" type="VARCHAR" size="255" required="false" />
        <column name="name" type="VARCHAR" size="255" required="true" />
        <column name="description" type="LONGVARCHAR" required="false" />

        <column name="gross_price" type="INTEGER" required="true" default="0" />
        <column name="price_to_pay" type="INTEGER" required="true" default="0" />

        <column name="tax_percentage" type="INTEGER" required="true" default="0" />

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order_item" phpName="OrderItem" refPhpName="Option">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>
    </table>

    <table name="sales_order_process"  phpName="PacSalesOrderProcess">
        <column name="id_sales_order_process" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="name" type="VARCHAR" size="255" required="true"/>

        <behavior name="timestampable"/>

        <unique>
            <unique-column name="name"/>
        </unique>
    </table>

    <table name="sales_order_note"  phpName="PacSalesOrderNote">
        <column name="id_sales_order_note" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />

        <column name="message" type="VARCHAR" size="255" required="true"/>
        <column name="command" type="VARCHAR" size="100" required="true"/>
        <column name="success" type="BOOLEAN" required="true" />
        <behavior name="timestampable"/>

        <column name="fk_acl_user" type="INTEGER" required="false"/>
        <foreign-key foreignTable="acl_user" phpName="AclUser" refPhpName="OrderNote">
            <reference local="fk_acl_user" foreign="id_acl_user"/>
        </foreign-key>

        <column name="fk_sales_order" type="INTEGER" required="true"/>
        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Note">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
    </table>

    <table name="sales_order_comment"  phpName="PacSalesOrderComment">
        <column name="id_sales_order_comment" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order" type="INTEGER" required="true"/>

        <column name="username" type="VARCHAR" required="false" default="NULL"/>
        <column name="message" type="LONGVARCHAR" required="true"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="OrderComment">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
    </table>

    <table name="sales_order_history"  phpName="PacSalesOrderHistory">
        <column name="id_sales_order_history" required="true" type="INTEGER" autoIncrement="true" primaryKey="true"/>
        <column name="fk_sales_order" type="INTEGER" required="true"/>

        <column name="email" required="false" size="255" type="VARCHAR"/>
        <column name="salutation" type="ENUM" valueSet="Mr, Mrs, Dr" required="false"/>
        <column name="first_name" required="false" size="100" type="VARCHAR"/>
        <column name="last_name" required="false" size="100" type="VARCHAR"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="History">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
    </table>

    <table name="sales_expense"  phpName="PacSalesExpense">
        <column name="id_sales_expense" required="true" type="INTEGER" autoIncrement="true" primaryKey="true"/>
        <column name="fk_sales_order_item" type="INTEGER" required="false" default="NULL"/>
        <column name="fk_sales_order" type="INTEGER" required="false" default="NULL"/>

        <column name="type" type="VARCHAR" size="150"/>
        <column name="name" type="VARCHAR" size="255"/>
        <column name="gross_price" type="INTEGER" required="true" />
        <column name="price_to_pay" type="INTEGER" required="true" />
        <column name="tax_percentage" type="INTEGER" required="false" />

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order_item" phpName="OrderItem" refPhpName="Expense">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>
        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Expense">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
        <unique>
            <unique-column name="fk_sales_order_item"/>
            <unique-column name="fk_sales_order"/>
            <unique-column name="type"/>
        </unique>
    </table>

    <table name="sales_discount"  phpName="PacSalesDiscount">
        <column name="id_sales_discount" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_sales_order" type="INTEGER" required="false"/>
        <column name="fk_sales_order_item" type="INTEGER" required="false"/>
        <column name="fk_sales_expense" type="INTEGER" required="false"/>
        <column name="fk_sales_order_item_option" type="INTEGER" required="false"/>
        <column name="is_refundable" type="TINYINT" default="0"/>
        <column name="amount" type="INTEGER" required="true" />
        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Discount">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>

        <foreign-key foreignTable="sales_order_item" phpName="OrderItem" refPhpName="Discount">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>

        <foreign-key foreignTable="sales_expense" phpName="Expense" refPhpName="Discount">
            <reference local="fk_sales_expense" foreign="id_sales_expense"/>
        </foreign-key>

        <foreign-key foreignTable="sales_order_item_option" phpName="Option" refPhpName="Discount">
            <reference local="fk_sales_order_item_option" foreign="id_sales_order_item_option"/>
        </foreign-key>
    </table>

</database>
