<?xml version="1.0"?>
<database name="zed"
          package="vendor/project-a/payment-package/ProjectA/Zed/Payment/Persistence"
          tablePrefix="pac_"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

    <table name="payment" idMethod="native"  phpName="PacPayment">
        <column name="id_payment" required="true" type="INTEGER" primaryKey="true" />
        <column name="transaction" required="true" size="60" type="VARCHAR"/>
        <column name="method" required="true" size="50" type="VARCHAR"/>
        <column name="provider" required="false" size="50" type="VARCHAR"/>
        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Payment">
            <reference local="id_payment" foreign="id_sales_order"/>
        </foreign-key>
        <behavior name="timestampable" />
    </table>

    <table name="payment_account" idMethod="native"  phpName="PacPaymentAccount">
        <column name="id_payment_account" required="true" type="INTEGER" primaryKey="true" autoIncrement="true" />
        <column name="fk_payment" required="true" type="INTEGER" />
        <column name="fk_payment_transaction" required="false" type="INTEGER" />
        <column name="amount_delta" required="true" type="INTEGER"/>
        <column name="amount_sum" required="true" type="INTEGER"/>
        <column name="type" type="ENUM" valueSet="create, credit, debit"/>
        <column name="action" required="true" size="50" type="VARCHAR"/>
        <column name="message" required="false" size="255" type="VARCHAR" default="NULL"/>
        <foreign-key foreignTable="payment" phpName="Payment" refPhpName="PaymentAccount">
            <reference local="fk_payment" foreign="id_payment"/>
        </foreign-key>
        <foreign-key foreignTable="payment_transaction" phpName="PaymentTransaction" refPhpName="PaymentAccount">
            <reference local="fk_payment_transaction" foreign="id_payment_transaction"/>
        </foreign-key>
        <index>
            <index-column name="action" />
        </index>
        <behavior name="timestampable" />
    </table>

    <table name="payment_transaction" idMethod="native"  phpName="PacPaymentTransaction">
        <column name="id_payment_transaction" required="true" type="INTEGER" primaryKey="true" autoIncrement="true"/>
        <column name="fk_payment" required="true" type="INTEGER" />
        <!-- <column name="fk_payment_account" required="false" type="INTEGER" /> -->
        <column name="reference_id" required="false" size="50" type="VARCHAR"/>
        <column name="sequence_nr" required="false" size="32" type="VARCHAR"/>
        <column name="event" required="true" size="50" type="VARCHAR"/>
        <column name="event_date" required="false" type="TIMESTAMP"/>
        <column name="is_outbound" required="true" type="BOOLEAN"/>
        <column name="is_success" required="true" type="BOOLEAN"/>
        <column name="message" required="false" size="255" type="VARCHAR"/>
        <column name="raw_request" required="false" type="LONGVARCHAR"/>
        <column name="raw_response" required="false" type="LONGVARCHAR"/>
        <foreign-key foreignTable="payment" phpName="Payment" refPhpName="PaymentTransaction">
            <reference local="fk_payment" foreign="id_payment"/>
        </foreign-key>
        <!--
        <foreign-key foreignTable="payment_account" phpName="PaymentAccount" refPhpName="PaymentTransaction">
            <reference local="fk_payment_account" foreign="id_payment_account"/>
        </foreign-key>
        -->
        <index>
            <index-column name="event" />
            <index-column name="reference_id" />
        </index>
        <behavior name="timestampable" />
    </table>

</database>
