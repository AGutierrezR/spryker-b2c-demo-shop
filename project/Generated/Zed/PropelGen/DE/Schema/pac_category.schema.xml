<?xml version="1.0"?>
<database name="zed"
          package="vendor/project-a/catalog-package/ProjectA/Zed/Category/Persistence"
          tablePrefix="pac_"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">


    <table name="category" idMethod="native"  phpName="PacCategory">
        <column name="id_category" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_category_name" required="true" type="INTEGER" />

        <column name="fk_category_scope" required="true" type="INTEGER" />

        <column name="lft" required="true" type="INTEGER" />
        <column name="rgt" required="true" type="INTEGER" />

        <column name="level" type="INTEGER" default="0" />

        <behavior name="nested_set">
            <parameter name="use_scope" value="true" />
            <parameter name="left_column" value="lft" />
            <parameter name="right_column" value="rgt" />
            <parameter name="level_column" value="level" />
            <parameter name="scope_column" value="fk_category_scope" />
        </behavior>
        <behavior name="timestampable"/>

        <foreign-key foreignTable="category_scope" phpName="Scope" refPhpName="Category">
            <reference foreign="id_category_scope" local="fk_category_scope"/>
        </foreign-key>
        <foreign-key foreignTable="category_name" phpName="Name" refPhpName="Category">
            <reference foreign="id_category_name" local="fk_category_name"/>
        </foreign-key>
    </table>

    <table name="category_name" idMethod="native"  phpName="PacCategoryName">
        <column name="id_category_name" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="name" type="VARCHAR" size="255" required="true" />
        <column name="status" type="INTEGER" default="1" />
    </table>

    <table name="category_attribute" idMethod="native"  phpName="PacCategoryAttribute">
        <column name="id_category_attribute" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_category" required="true" type="INTEGER" />
        <column name="fk_category_attribute_key" required="true" type="INTEGER" />
        <column name="value" required="true" type="LONGVARCHAR" sqlType="LONGTEXT" />

        <foreign-key foreignTable="category" phpName="Category" refPhpName="Attribute">
            <reference foreign="id_category" local="fk_category"/>
        </foreign-key>
        <foreign-key foreignTable="category_attribute_key" phpName="AttributeKey" refPhpName="Attribute">
            <reference foreign="id_category_attribute_key" local="fk_category_attribute_key"/>
        </foreign-key>

        <unique name="uidx_category_attribute">
            <unique-column name="fk_category" />
            <unique-column name="fk_category_attribute_key" />
        </unique>
    </table>

    <table name="category_attribute_key" idMethod="native"  phpName="PacCategoryAttributeKey">
        <column name="id_category_attribute_key" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_category_scope" required="true" type="INTEGER" />
        <column name="name" required="true" type="VARCHAR" size="255"/>
        <column name="type" required="true" type="VARCHAR" size="25" />
        <column name="config" required="false"  type="VARCHAR" size="255" />

        <foreign-key foreignTable="category_scope" phpName="Scope" refPhpName="AttributeKey">
            <reference foreign="id_category_scope" local="fk_category_scope"/>
        </foreign-key>

    </table>


    <table name="category_scope" idMethod="native"  phpName="PacCategoryScope">
        <column name="id_category_scope" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="name" required="true" />

        <unique>
            <unique-column name="name" />
        </unique>

        <behavior name="timestampable"/>
    </table>

</database>