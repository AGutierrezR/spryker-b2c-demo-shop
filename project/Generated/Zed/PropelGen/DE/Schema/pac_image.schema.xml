<?xml version="1.0"?>
<database name="zed"
          package="vendor/project-a/catalog-package/ProjectA/Zed/Image/Persistence"
          tablePrefix="pac_"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

    <table name="image_size"  phpName="PacImageSize">
        <column name="id_image_size" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="name" type="VARCHAR" required="true" />
        <column name="width" type="INTEGER" required="true" />
        <column name="height" type="INTEGER" required="true" />
        <column name="quality" type="INTEGER" required="true" />
        <behavior name="timestampable"/>
    </table>

    <table name="image"  phpName="PacImage">
        <column name="id_image" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_image_size" required="true" type="INTEGER" />
        <column name="mapping_id" type="INTEGER" required="true" />
        <column name="priority" type="INTEGER" required="true" default="50" />
        <column name="type" type="ENUM" valueSet="product,manufacturer,brand,cms" required="true" />
        <column name="original_image_path" type="VARCHAR" required="true" />
        <column name="base_url_key" type="VARCHAR" required="true" />
        <behavior name="timestampable"/>
        <index>
            <index-column name="mapping_id"/>
        </index>
        <index>
            <index-column name="type"/>
        </index>
        <foreign-key foreignTable="image_size" phpName="ImageSize"
                     refPhpName="Image">
            <reference local="fk_image_size" foreign="id_image_size"/>
        </foreign-key>
    </table>

    <table name="image_product"  phpName="PacImageProduct">
        <column name="id_image_product" type="INTEGER" required="true" primaryKey="true" autoIncrement="true" />
        <column name="name" type="VARCHAR" size="255" required="true" />
        <column name="fk_catalog_product" type="INTEGER" required="true" />
        <column name="fk_image" type="INTEGER" required="true" />
        <foreign-key foreignTable="catalog_product" phpName="Product"
                     refPhpName="ImageProduct">
            <reference local="fk_catalog_product" foreign="id_catalog_product" />
        </foreign-key>
        <foreign-key foreignTable="image" phpName="Image"
                     refPhpName="ImageProduct" onDelete="CASCADE">
            <reference local="fk_image" foreign="id_image" />
        </foreign-key>
        <unique>
            <unique-column name="fk_image" />
            <unique-column name="fk_catalog_product" />
        </unique>
    </table>

</database>