<?xml version="1.0"?>
<database name="zed"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

    <table name="sao_sales_ccvalidation" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesCCValidation">
        <column name="id_validation" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="fk_sales_order" type="INTEGER" required="true"/>

        <column name="valid_js" type="INTEGER" default="null"/>
        <column name="valid_payment_provider" type="INTEGER" default="null"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="pac_sales_order" phpName="Order" refPhpName="CCValidation">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>
    </table>

    <table name="sao_sales_tax" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesTax">
        <column name="id_sales_tax" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>

        <column name="tax_percentage" type="DECIMAL" size="8" scale="4" required="false"
                description="/tax percentage/"/>

        <column name="fk_misc_country" type="INTEGER" required="true"/>
        <column name="zip_code" size="15" type="VARCHAR" required="true"/>
        <column name="name1" size="255" type="VARCHAR" required="false"/>
        <column name="name2" size="255" type="VARCHAR" required="false"/>
        <column name="name3" size="255" type="VARCHAR" required="false"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="pac_misc_country" phpName="Country" refPhpName="SalesTax">
            <reference local="fk_misc_country" foreign="id_misc_country"/>
        </foreign-key>

    </table>

    <table name="sao_sales_order_address" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesOrderAddress">
        <column name="id_sales_order_address" type="INTEGER" required="true" primaryKey="true"/>

        <column name="fk_misc_region" type="INTEGER" required="false"/>

        <foreign-key foreignTable="pac_sales_order_address" phpName="Address" refPhpName="SaoAddress">
            <reference foreign="id_sales_order_address" local="id_sales_order_address"/>
        </foreign-key>

        <foreign-key foreignTable="sao_misc_region" phpName="Region" refPhpName="SaoAddress">
            <reference foreign="id_region" local="fk_misc_region"/>
        </foreign-key>
    </table>

    <table name="sao_sales_order_item" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesOrderItem">
        <column name="id_sales_order_item" type="INTEGER" required="true" primaryKey="true"/>
        <column name="fk_artist_sales" type="INTEGER" required="false"/>
        <column name="impression" type="INTEGER" required="false"/>

        <column name="fk_misc_country" type="INTEGER"/>
        <column name="fk_misc_region" type="INTEGER"/>

        <column name="salutation" type="ENUM" valueSet="Mr, Mrs, Dr"/>
        <column name="first_name" size="100" type="VARCHAR"/>
        <column name="middle_name" size="100" type="VARCHAR"/>
        <column name="last_name" size="100" type="VARCHAR"/>
        <column name="address1"  size="255" type="VARCHAR"/>
        <column name="address2" size="255" type="VARCHAR"/>
        <column name="address3" size="255" type="VARCHAR"/>
        <column name="company" size="255" type="VARCHAR"/>
        <column name="city" size="255" type="VARCHAR"/>
        <column name="zip_code" size="15" type="VARCHAR"/>
        <column name="po_box" size="255" type="VARCHAR"/>
        <column name="phone" size="255" type="VARCHAR"/>
        <column name="cell_phone" size="255" type="VARCHAR"/>
        <column name="description" size="255" type="VARCHAR"/>
        <column name="comment" size="255" type="VARCHAR"/>
        <column name="email" size="255" type="VARCHAR"/>
        <column name="marked_for_refund" required="false" type="BOOLEAN" default="false"/>
        <behavior name="timestampable"/>
        <behavior name="versionable">
            <parameter name="log_created_at" value="true" />
            <parameter name="log_created_by" value="true" />
            <parameter name="log_comment" value="true" />
        </behavior>

        <foreign-key foreignTable="pac_misc_country" phpName="Country" refPhpName="SaoSalesOrderItemAddress">
            <reference local="fk_misc_country" foreign="id_misc_country"/>
        </foreign-key>
        <foreign-key foreignTable="sao_misc_region" phpName="Region" refPhpName="SaoSaleOrderItemAddress">
            <reference foreign="id_region" local="fk_misc_region"/>
        </foreign-key>

        <foreign-key foreignTable="pac_sales_order_item" phpName="SalesOrderItem" refPhpName="SaoSalesOrderItem">
            <reference foreign="id_sales_order_item" local="id_sales_order_item"/>
        </foreign-key>
    </table>

    <table name="sao_sales_order" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesOrder">

        <column name="id_sales_order" type="INTEGER" required="true" primaryKey="true"/>
        <column name="flagged" type="INTEGER" size="1" required="false" default="-1"/>

        <foreign-key foreignTable="pac_sales_order" phpName="SalesOrder" refPhpName="SaoSalesOrder">
            <reference foreign="id_sales_order" local="id_sales_order"/>
        </foreign-key>
    </table>


    <table name="sao_sales_discount" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesDiscount">

        <column name="id_sales_discount" type="INTEGER" required="true" primaryKey="true"/>
        <column name="saatchi_amount" type="INTEGER" required="false" default="NULL"/>
        <column name="artist_amount" type="INTEGER" required="false" default="NULL"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="pac_sales_discount" phpName="Discount" refPhpName="SalesDiscount">
            <reference foreign="id_sales_discount" local="id_sales_discount"/>
        </foreign-key>
    </table>

    <table name="sao_sales_order_item_notification" package="project/Sao/Zed/Sales/Persistence"
            phpName="SaoSalesOrderItemNotification">

        <column name="id_sao_sales_order_item_notification" type="INTEGER" required="true" autoIncrement="true"
                primaryKey="true"/>
        <column name="fk_sales_order_item" type="INTEGER" required="true"/>
        <column name="hash" type="VARCHAR" size="32" required="true"/>
        <column name="event" type="VARCHAR" size="255" required="true"/>
        <column name="event_triggered" required="true" type="ENUM" valueSet="False,True" default="False"/>
        <column name="status" required="true" type="ENUM" valueSet="Disabled,Enabled,Unknown" default="Unknown"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="pac_sales_order_item" phpName="SalesOrderItem"
                     refPhpName="SaoSalesOrderItemNotification">
            <reference foreign="id_sales_order_item" local="fk_sales_order_item"/>
        </foreign-key>

        <unique>
            <unique-column name="hash"/>
        </unique>
    </table>

</database>
