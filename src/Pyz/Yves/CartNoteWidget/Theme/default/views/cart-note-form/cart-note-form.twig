{% extends template('widget') %}

{% define data = {
    idQuote: _view.cart.idQuote,
    form: _widget.cartNoteForm
} %}

{% set canWrite = (not is_granted('IS_AUTHENTICATED_FULLY') or can('WriteSharedCartPermissionPlugin', data.idQuote)) %}

{% block body %}
    {% if canWrite %}
        <div class="cart-note">
            <h4 class="cart-toggler__title js-cart-toggler__title-trigger" data-toggle-target=".js-cart-toggler__content-target">
                {{ 'cart.note-title' | trans }}
            </h4>
            <div class="cart-toggler__content js-cart-toggler__content-target is-hidden">
                {% include molecule('form') with {
                    data: {
                        form: data.form,
                        options: {
                            action: url('cart-note/quote')
                        },
                        submit: {
                            enable: false,
                            text: 'cart_note.form.save' | trans
                        }
                    }
                } only %}
            </div>
        </div>
    {% endif %}

    {% include molecule('toggler-accordeon') with {
        attributes: {
            trigger: '.js-cart-toggler__title-trigger',
            'class-to-toggle': 'is-hidden'
        }
    } only %}

{% endblock %}
