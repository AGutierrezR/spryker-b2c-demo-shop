{% extends template('page-layout-checkout', 'CheckoutPage') %}

{% define data = {
    backUrl: _view.previousStepUrl,
    transfer: _view.quoteTransfer,
    cartItems: _view.cartItems,
    shippingAddress: _view.quoteTransfer.shippingAddress,
    billingAddress: _view.quoteTransfer.billingAddress,
    shipmentMethod: _view.quoteTransfer.shipment.method.name,
    paymentMethod: _view.quoteTransfer.payment.paymentMethod,

    forms: {
        summary: _view.summaryForm
    },

    overview: {
        shipmentMethod: _view.quoteTransfer.shipment.method.name,
        voucherDiscounts: _view.quoteTransfer.voucherDiscounts,
        cartRuleDiscounts: _view.quoteTransfer.cartRuleDiscounts,

        prices: {
            subTotal: _view.quoteTransfer.totals.subtotal,
            storeCurrency: _view.quoteTransfer.shipment.method.storeCurrencyPrice,
            grandTotal: _view.quoteTransfer.totals.grandtotal,
            tax: _view.quoteTransfer.totals.taxtotal.amount,
            discountTotal: _view.quoteTransfer.totals.discounttotal | default(null)
        }
    },

    title: null
} %}

{% block content %}
    <div class="checkout-layout checkout-layout--summary-step checkout-layout--full-width">
        <div class="grid">
            <div class="col col--sm-12 col--lg-6">
                <div class="summary-address">
                    <div class="summary-address__title">
                        <h5>{{ 'checkout.step.summary.shipping' | trans }}</h5>
                        {{ 'checkout.step.summary.with_method' | trans }} <strong>{{ data.shipmentMethod }}</strong>
                    </div>
                    {% include molecule('display-address') with {
                        class: 'text-small',
                        data: {
                            address: data.shippingAddress
                        }
                    } only %}
                </div>
                <div class="summary-address">
                    <div class="summary-address__title">
                        <h5>{{ 'checkout.step.summary.payment' | trans }}</h5>
                        {{ 'checkout.step.summary.with_method' | trans }} <strong>{{data.paymentMethod}}</strong>
                    </div>
                    {% include molecule('display-address') with {
                        class: 'text-small',
                        data: {
                            address: data.billingAddress
                        }
                    } only %}
                </div>
            </div>

            <div class="col col--sm-12 col--lg-6 summary-right">
                <h5>{{ 'page.checkout.summary.product' | trans }}</h5>
                <div class="summary-product-list">
                    {#{% for item in data.cartItems %}
                        {% set item = item.bundleProduct is defined ? item.bundleProduct : item %}
                        {% set firstImage = item.images | first %}
                        {% include molecule('cart-item', 'CartPage') with {
                            class: 'summary-product-list',
                            data: {
                                name: item.name,
                                image: firstImage.externalUrlSmall,
                                quantity: item.quantity,
                                price: item.sumPrice | money,
                                options: item.productOptions | default({}),
                                bundleItems: item.bundleItems | default([])
                            }
                        } only %}
                    {% endfor %}#}
                    {% for cartItem in data.cartItems %}
                        {% include molecule('cart-item', 'CartPage') with {
                            class: 'summary-product-list__item',
                            data: {
                                cart: null,
                                cartItem: cartItem,
                                attributes: data.attributes[cartItem.sku] | default([])
                            }
                        } only %}
                    {% endfor %}
                </div>

                {{ widget('CartNoteQuoteNoteWidgetPlugin', data.transfer) }}
                <div class="summary-voucher">
                    {{ widget('CheckoutVoucherFormWidgetPlugin', data.transfer) }}
                </div>
                <div class="summary-overview">
                    {% include molecule('summary-overview', 'CheckoutPage') with {
                        data: data.overview
                    } only %}
                </div>
                {% include molecule('form') with {
                    class: 'checkout-buttons',
                    data: {
                        form: data.forms.summary,
                        submit: {
                            enable: true,
                            text: 'checkout.step.place.order' | trans,
                            class: 'button button--black button--big button--expand'
                        }
                    }
                } only %}
            </div>

        </div>
    </div>
{% endblock %}
