{% extends view('summary', '@SprykerShop:CheckoutPage') %}

{#{% define data = {#}
    {#breadcrumbs: _view.stepBreadcrumbs.breadcrumbs | default([]),#}
    {#shipmentMethodName: _view.quoteTransfer.shipment.method.carrierName | trans,#}
    {#payment: _view.quoteTransfer.payment,#}
    {#paymentMethodName: _view.quoteTransfer.payment.dummyPayment.cardType | default(null),#}
{#} %}#}

{#{% block content %}#}
    {#<div class="grid summary-item">#}
        {#<div class="col col--sm-12 col--lg-6 summary-page__col">#}
            {#<div class="summary-item__wrap">#}
                {#<h2 class="title title--checkout">{{ 'checkout.step.address.title' | trans }}</h2>#}
                {#<div class="grid">#}
                    {#<div class="col col--sm-12 col--md-6">#}
                        {#<strong>{{ 'page.checkout.summary.shipping' | trans }}</strong>#}
                        {#{% include molecule('display-address', 'CheckoutPage') with {#}
                            {#class: 'text-small',#}
                            {#data: {#}
                                {#address: data.shippingAddress,#}
                            {#},#}
                        {#} only %}#}

                        {#{% for step in data.breadcrumbs %}#}
                            {#{% if step.title == 'checkout.step.address.title' %}#}
                                {#<a href="{{url(step.route)}}" class="link link--darkest link--edit spacing-top spacing-top--big">{{ 'general.edit.button' | trans }}</a>#}
                            {#{% endif %}#}
                        {#{% endfor %}#}

                    {#</div>#}
                    {#<div class="summary-page__address-indent col col--sm-12 col--md-6">#}
                        {#<strong>{{ 'page.checkout.address.billing-address' | trans }}</strong>#}
                        {#{% include molecule('display-address', 'CheckoutPage') with {#}
                            {#class: 'text-small',#}
                            {#data: {#}
                                {#address: data.billingAddress,#}
                            {#},#}
                        {#} only %}#}

                        {#{% for step in data.breadcrumbs %}#}
                            {#{% if step.title == 'checkout.step.address.title' %}#}
                                {#<a href="{{url(step.route)}}" class="link link--darkest link--edit spacing-top spacing-top--big">{{ 'general.edit.button' | trans }}</a>#}
                            {#{% endif %}#}
                        {#{% endfor %}#}
                    {#</div>#}
                {#</div>#}
            {#</div>#}
            {#<div class="summary-item__wrap">#}
                {#<h2 class="title title--checkout">{{ 'checkout.step.summary.shipping' | trans }}</h2>#}
                {#{% set shipmentMethodName = data.forms.summary.vars.value.shipment.method.carrierName %}#}

                {#<div class="heading__logo heading__logo--indent">#}
                    {#<img src="{{ publicPath('images/shipment-' ~ shipmentMethodName | replace({' ': ''}) ~ '.png') }}" width="65" alt="{{ shipmentMethodName }}">#}
                {#</div>#}

                {#<ul class="list">#}
                    {#<li class="list__item">{{ data.shipmentMethod.carrierName | trans }}</li>#}
                    {#<li class="list__item">{{ data.shipmentMethod.name }} {{ data.shipmentMethod.storeCurrencyPrice | money }}</li>#}
                {#</ul>#}

                {#{% for step in data.breadcrumbs %}#}
                    {#{% if step.title == 'checkout.step.shipment.title' %}#}
                        {#<a href="{{url(step.route)}}" class="link link--darkest link--edit spacing-top spacing-top--big">{{ 'general.edit.button' | trans }}</a>#}
                    {#{% endif %}#}
                {#{% endfor %}#}
            {#</div>#}
            {#<div class="summary-item__wrap">#}
                {#<h2 class="title title--checkout">{{ 'checkout.step.summary.payment' | trans }}</h2>#}
                {#{% if data.paymentMethodName == 'Visa' %}#}
                    {#<div class="heading__logo heading__logo--indent">#}
                        {#<img class="heading__logo--img" src="{{ publicPath('images/logo-visa.png') }}" width="50" height="18" alt="Visa">#}
                    {#</div>#}
                {#{% endif %}#}
                {#{% if data.paymentMethodName == 'Master Card' %}#}
                    {#<div class="heading__logo heading__logo--indent">#}
                        {#<img class="heading__logo--img" src="{{ publicPath('images/logo-mastercard.png') }}" width="29" height="22" alt="Master card">#}
                    {#</div>#}
                {#{% endif %}#}
                {#<ul class="list">#}
                    {#{% if data.payment.paymentSelection == 'Nopayment' %}#}
                        {#{% for payment in data.cart.payments %}#}
                            {#<li class="list-item">#}
                                {#{% if payment.giftCard is defined and payment.giftCard %}#}
                                    {#{{ 'cart.giftcard.label' | trans }}#}
                                {#{% else %}#}
                                    {#{{ payment.paymentMethod }} <span class="float-right"></span>#}
                                {#{% endif %}#}
                            {#</li>#}
                        {#{% endfor %}#}
                    {#{% else %}#}
                        {#<li class="list__item">{{ data.payment.paymentSelection | trans }}</li>#}
                    {#{% endif %}#}

                    {#{% if data.payment.paymentSelection == 'dummyPaymentCreditCard' %}#}
                        {#{% set partOfCardNumder = data.payment.dummyPayment.cardNumber[(data.payment.dummyPayment.cardNumber | length)-3:] %}#}
                        {#<li class="list__item">{{ 'dummyPaymentCreditCard.card_type' | trans }}: {{ data.payment.dummyPayment.cardType }}</li>#}
                        {#<li class="list__item">{{ 'dummyPaymentCreditCard.card_number' | trans }}: *********{{ partOfCardNumder }}</li>#}
                        {#<li class="list__item">{{ 'dummyPaymentCreditCard.name_on_card' | trans }}: {{ data.payment.dummyPayment.nameOnCard }}</li>#}
                        {#<li class="list__item">{{ 'dummyPaymentCreditCard.card_expires' | trans }}: {{ data.payment.dummyPayment.cardExpiresMonth }}, {{ data.payment.dummyPayment.cardExpiresYear }}</li>#}
                    {#{% endif %}#}
                {#</ul>#}

                {#{% for step in data.breadcrumbs %}#}
                    {#{% if step.title == 'checkout.step.payment.title' %}#}
                        {#<a href="{{url(step.route)}}" class="link link--darkest link--edit spacing-top spacing-top--big">{{ 'general.edit.button' | trans }}</a>#}
                    {#{% endif %}#}
                {#{% endfor %}#}
            {#</div>#}
        {#</div>#}

        {#<div class="col col--sm-12 col--lg-6 summary-page__col">#}
            {#<div class="summary-item__wrap">#}
                {#<h2 class="title title--checkout"> {{ 'page.checkout.summary.products' | trans }}</h2>#}
                {#<div class="summary-item__product-list">#}
                    {#{% for item in data.cartItems %}#}
                        {#{% set item = item.bundleProduct is defined ? item.bundleProduct : item %}#}
                        {#{% set firstImage = item.images | first %}#}

                        {#{% embed molecule('product-item') with {#}
                            {#data: {#}
                                {#productItem: item,#}
                                {#options: item.productOptions | default([]),#}
                                {#product: data.transfer,#}
                            {#},#}
                        {#} only %}#}
                            {#{% block options %}#}
                                {#{% if data.productItem.concreteAttributes is not empty %}#}
                                    {#<ul>#}
                                        {#{% for key, item in data.productItem.concreteAttributes %}#}
                                            {#<li> {{ ('product.attribute.' ~ key) | trans }}: {{ item }}</li>#}
                                        {#{% endfor %}#}
                                    {#</ul>#}
                                {#{% endif %}#}
                            {#{% endblock %}#}

                            {#{% block quantity %}#}
                                {#<div>#}
                                    {#{{ 'cart.item_quantity' | trans }}: {{ data.productItem.quantity }}#}
                                {#</div>#}
                            {#{% endblock %}#}

                            {#{% block summary %}#}
                                {#{% if data.options is defined and data.options is not empty %}#}
                                    {#<div class="grid grid--right">#}
                                        {#{% include molecule('product-item-summary') with {#}
                                            {#class: 'col',#}
                                            {#data: {#}
                                                {#options: data.options,#}
                                            {#},#}
                                        {#} only %}#}
                                    {#</div>#}
                                {#{% endif %}#}
                            {#{% endblock %}#}
                        {#{% endembed %}#}
                    {#{% endfor %}#}
                {#</div>#}
            {#</div>#}
            {#<div class="summary-item__wrap">#}
                {#<h2 class="title title--checkout">{{ 'checkout.step.summary.total' | trans }}</h2>#}
                {#{% widget 'CartCodeFormWidget' args [data.transfer] only %}{% endwidget %}#}

                {#{% embed molecule('summary-overview', 'CheckoutPage') with {#}
                    {#data: data.overview,#}
                    {#embed: {#}
                        {#cart: data.cart,#}
                    {#},#}
                {#} only %}#}
                    {#{% block giftCard %}#}
                        {#{% include molecule('gift-card-payment-summary', 'GiftCardWidget') ignore missing with {#}
                            {#data: {#}
                                {#cart: embed.cart,#}
                            {#},#}
                        {#} only %}#}
                    {#{% endblock %}#}
                {#{% endembed %}#}

                {#{% include molecule('form') with {#}
                    {#class: 'checkout-buttons',#}
                    {#data: {#}
                        {#form: data.forms.summary,#}
                        {#submit: {#}
                            {#enable: true,#}
                            {#text: 'checkout.step.place.order' | trans,#}
                            {#class: 'form__action--checkout button  button--large button--expand',#}
                        {#},#}
                    {#},#}
                    {#modifiers: ['checkout-form-elements'],#}
                {#} only %}#}
            {#</div>#}
        {#</div>#}
    {#</div>#}
{#{% endblock %}#}

{% block content %}
    {% set isGiftCardExists = null %}

    <div class="grid">
        <h2 class="title title--checkout col col--sm-12">{{ 'checkout.step.summary.title' | trans }}</h2>

        {% for shipmentGroup in data.shipmentGroups %}
            <article class="checkout-block grid col col--sm-12">
                <div class="col col--sm-12 col--lg-7">
                    <h3 class="title title--checkout-block">
                        {{ 'page.checkout.shipment.shipment_group_heading' | trans({
                            '%current%': loop.index,
                            '%total%': loop.length
                        }) }}
                    </h3>

                    {% for item in shipmentGroup.items %}
                        {% set isGiftCardExists = item.giftCardMetadata is not null and item.giftCardMetadata.isGiftCard %}
                        {% set item = item.bundleProduct ?? item %}

                        {% embed molecule('product-item') with {
                            modifiers: ['expand', 'checkout', 'checkout-shipment', 'right-indent-from-tablet'],
                            data: {
                                product: shipmentGroup.items,
                                productItem: item,
                                canEditCart: false,
                                additionalContainerClass: '',
                                productOptionsModifiers: ['checkout'],
                            },
                        } only %}
                            {% block image %}
                                <div class="{{ component.renderClass(config.name ~ '__image', modifiers) }} col">
                                    {% include molecule('product-image') with {
                                        modifiers: ['no-side-indent'],
                                        data: {
                                            name: data.productItem.name,
                                            image: data.productItem.images[0],
                                        },
                                    } only %}
                                </div>
                            {% endblock %}

                            {% block title %}
                                <div class="{{ component.renderClass(config.name ~ '__title', modifiers) }} col col--sm-12 col--lg-8">
                                    {{ data.productItem.name }}
                                </div>
                            {% endblock %}

                            {% block bundles %}{% endblock %}
                        {% endembed %}
                    {% endfor %}
                </div>

                <div class="col col--sm-12 col--lg-5">
                    {% include molecule('summary-sidebar', 'CheckoutPage') with {
                        data: {
                            shipment: shipmentGroup.shipment,
                            isGiftCardExists: isGiftCardExists,
                        },
                    } only %}
                </div>
            </article>
        {% endfor %}
    </div>

    {#<div class="grid checkout-block">#}
        {#<div class="col col--sm-12 col--lg-6">#}
            {#{% include molecule('summary-item-box', 'CheckoutPage') with {#}
                {#modifiers: ['mobile-border-top'],#}
                {#data: {#}
                    {#title: 'checkout.step.summary.payment' | trans,#}
                    {#method: data.paymentMethod,#}
                    {#iconName: data.paymentMethod | lower,#}
                    {#editUrl: 'checkout-payment',#}
                    {#canEdit: true,#}
                {#},#}
            {#} only %}#}
        {#</div>#}
        {#<div class="col col--sm-12 col--lg-6">#}
            {#{% include molecule('summary-item-box', 'CheckoutPage') with {#}
                {#data: {#}
                    {#title: 'checkout.step.summary.billing_address' | trans,#}
                    {#address: data.billingAddress,#}
                    {#editUrl: 'checkout-address',#}
                    {#canEdit: true,#}
                {#},#}
            {#} only %}#}
        {#</div>#}
    {#</div>#}

    <div class="grid">
        <div class="col col--sm-12">
            {% widget 'CartCodeFormWidget' args [data.transfer] only %}{% endwidget %}

            {% embed molecule('form') with {
                modifiers: ['checkout-actions'],
                data: {
                    form: data.forms.summary,
                    submit: {
                        enable: true,
                        text: 'checkout.step.place.order' | trans,
                        class: 'form__action--checkout button button--large button--expand',
                    },
                    cancel: {
                        enable: true,
                        url: data.backUrl,
                        text: 'general.back.button' | trans,
                        icon: '',
                        class: 'form__action--checkout button button--hollow button--expand',
                    },
                },
                embed: {
                    overview: data.overview,
                    cart: data.cart,
                },
            } only %}
                {% block body %}
                    {% embed molecule('summary-overview', 'CheckoutPage') with {
                        class: 'spacing-bottom spacing-bottom--bigger',
                        data: embed.overview,
                        embed: {
                            cart: embed.cart,
                        },
                    } only %}
                        {% block giftCard %}
                            {% include molecule('gift-card-payment-summary', 'GiftCardWidget') ignore missing with {
                                data: {
                                    cart: embed.cart,
                                },
                            } only %}
                        {% endblock %}
                    {% endembed %}

                    {{ parent() }}
                {% endblock %}
            {% endembed %}
        </div>
    </div>
{% endblock %}
