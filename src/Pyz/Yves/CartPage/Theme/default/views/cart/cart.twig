{% extends template('page-layout-main') %}

{% define config = {
    name: 'shopping-cart'
} %}

{% define data = {
    cart: _view.cart,
    cartItems: _view.cartItems,
    isQuoteValid: _view.isQuoteValid,
    attributes: _view.attributes,
    request: app.request,

    title: 'cart.cart' | trans
} %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
    {% if widgetExists('CartOperationsWidgetPlugin') %}
        {% set cartOperation = widget('CartOperationsWidgetPlugin', data.cart) | trim %}

        {% if cartOperation is not empty %}
            {{ cartOperation | raw }}
        {% endif %}
    {% endif %}
{% endblock %}

{% block content %}
    <div class="{{ config.name }}">
        {% if widgetExists('CartToShoppingListWidgetPlugin') and data.cart.idQuote is not empty and data.cart.items is not empty %}
            <div>
                {{ widget('CartToShoppingListWidgetPlugin', data.cart.idQuote) }}
            </div>
        {% endif %}

        {% if data.cart.items is empty %}
            <div class="{{ config.name }}__empty text-center">
                {% include atom('icon') with {
                    modifiers: ['biggest'],
                    class: 'text-alt',
                    data: {
                        name: config.name
                    }
                } only %}
                <h1>{{ data.title }}</h1>
                <h6>{{ 'cart.empty' | trans }}</h6>
            </div>
        {% else %}
            <div class="grid grid--spaced-lg">
                <div class="col col--sm-12 col--lg-8">
                    <div class="{{ config.name }}__block {{ config.name }}__block--left">
                        <div class="{{ config.name }}__box grid grid--middle grid--justify">
                            <h2 class="{{ config.name }}__title col">{{ 'cart.title1' | trans }}</h2>
                            <h6 class="{{ config.name }}__quantity col">{{ app['cart.quantity'] }} {{ 'item' | trans }}</h6>
                        </div>
                        <div class="{{ config.name }}__items-container">
                            {% for cartItem in data.cartItems %}
                                {% include molecule('cart-item', 'CartPage') with {
                                    class: config.name ~ '__item',
                                    data: {
                                        cart: data.cart,
                                        cartItem: cartItem,
                                        attributes: data.attributes[cartItem.sku] | default([])
                                    }
                                } only %}
                            {% endfor %}
                        </div>
                        {{ widget('DiscountPromotionItemListWidgetPlugin', data.cart, data.request) }}
                    </div>
                </div>

                <div class="col col--sm-12 col--lg-4">
                    <div class="{{ config.name }}__sidebar {{ config.name }}__block">
                        <h2 class="{{ config.name }}__title {{ config.name }}__box">{{ 'cart.title2' | trans }}</h2>
                        <div class="{{ config.name }}__box {{ config.name }}__box--empty"></div>
                        <div class="{{ config.name }}__box">
                            {% if not is_granted('IS_AUTHENTICATED_FULLY') or can('WriteSharedCartPermissionPlugin', data.cart.idQuote) %}
                                {{ widget('DiscountVoucherFormWidgetPlugin') }}
                            {% endif %}
                        </div>
                        <div class="{{ config.name }}__box {{ config.name }}__box--empty"></div>
                        {% include molecule('cart-summary', 'CartPage') with {
                            data: {
                                cart: data.cart,
                                isQuoteValid: data.isQuoteValid
                            }
                        } only %}
                    </div>
                </div>
            </div>
        {% endif %}

        {{ widget('UpSellingProductsWidgetPlugin', data.cart) }}
        {{ widget('MultiCartListWidgetPlugin', data.cart) }}
    </div>
{% endblock %}
