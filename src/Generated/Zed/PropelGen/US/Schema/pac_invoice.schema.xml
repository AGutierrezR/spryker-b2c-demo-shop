<?xml version="1.0"?>
<database name="zed"
          package="vendor/project-a/sales-package/ProjectA/Zed/Invoice/Persistence"
          tablePrefix="pac_"
          defaultIdMethod="native"
          defaultPhpNamingMethod="underscore"
          baseClass="ProjectA_Zed_Library_Propel_BaseObject"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://xsd.propelorm.org/1.6/database.xsd">

    <table name="invoice"  phpName="PacInvoice">
        <column name="id_invoice" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="invoice_number" type="VARCHAR" size="255" required="false" />
        <column name="fk_sales_order" required="true" type="INTEGER" />
        <column name="note" size="255" type="VARCHAR"/>
        <column name="currency_code" size="20" type="VARCHAR"/>
        <column name="type" type="ENUM" valueSet="invoice,reverse_invoice" required="true" default="invoice" />

        <behavior name="timestampable"/>

        <unique>
            <unique-column name="invoice_number"/>
        </unique>

        <foreign-key foreignTable="sales_order" phpName="Order" refPhpName="Invoice">
            <reference local="fk_sales_order" foreign="id_sales_order"/>
        </foreign-key>

    </table>

    <table name="invoice_item"  phpName="PacInvoiceItem">
        <column name="id_invoice_item" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_invoice" type="INTEGER" required="true"/>
        <column name="fk_sales_order_item" type="INTEGER" required="true"/>

        <behavior name="timestampable"/>

        <foreign-key foreignTable="sales_order_item" phpName="Item" refPhpName="InvoiceItem">
            <reference local="fk_sales_order_item" foreign="id_sales_order_item"/>
        </foreign-key>
        <foreign-key foreignTable="invoice" phpName="Invoice" refPhpName="InvoiceItem">
            <reference local="fk_invoice" foreign="id_invoice"/>
        </foreign-key>
    </table>

    <table name="invoice_document"  phpName="PacInvoiceDocument">
        <column name="id_invoice_document" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="fk_invoice" type="INTEGER" required="true"/>
        <column name="content" type="BLOB" required="false"/>
        <column name="layout_type" type="TINYINT" required="true" default="0"/>
        <column name="content_type" type="ENUM" valueSet="text,pdf" required="true" default="pdf" />
        <column name="filename" type="VARCHAR" size="255" required="false" />

        <behavior name="timestampable"/>

        <index>
            <index-column name="layout_type" />
        </index>
        <index>
            <index-column name="content_type" />
        </index>
        <foreign-key foreignTable="invoice" phpName="Invoice" refPhpName="InvoiceDocument">
            <reference local="fk_invoice" foreign="id_invoice"/>
        </foreign-key>
    </table>

    <table name="invoice_number"  phpName="PacInvoiceNumber">
        <column name="id_invoice_number" required="true" type="INTEGER" autoIncrement="true" primaryKey="true" />
        <column name="date" type="INTEGER" size="6" required="true"/>
        <column name="increment_id" type="VARCHAR" size="35" required="true"/>

        <behavior name="timestampable"/>

        <index>
            <index-column name="increment_id" />
        </index>
    </table>

</database>
